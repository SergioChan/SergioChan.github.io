<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>ä½¿ç”¨ Photon åœ¨ Unity é‡Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå¤šäººè”æœºæ¸¸æˆ | Sergio Chan</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="Born hacker, Full-stack Developer. &lt;br/&gt; Crazy fan of Hackathons all around the world. &lt;br/&gt; Founder of Hackathon team &lt;em&gt;hACKbUSTER&lt;/em&gt; and open-source animation organization &lt;em&gt;Animatious&lt;/em&gt;.">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="ä½¿ç”¨ Photon åœ¨ Unity é‡Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå¤šäººè”æœºæ¸¸æˆ | Sergio Chan">
    <meta name="twitter:description" content="Born hacker, Full-stack Developer. &lt;br/&gt; Crazy fan of Hackathons all around the world. &lt;br/&gt; Founder of Hackathon team &lt;em&gt;hACKbUSTER&lt;/em&gt; and open-source animation organization &lt;em&gt;Animatious&lt;/em&gt;.">

    <meta property="og:type" content="article">
    <meta property="og:title" content="ä½¿ç”¨ Photon åœ¨ Unity é‡Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå¤šäººè”æœºæ¸¸æˆ | Sergio Chan">
    <meta property="og:description" content="Born hacker, Full-stack Developer. &lt;br/&gt; Crazy fan of Hackathons all around the world. &lt;br/&gt; Founder of Hackathon team &lt;em&gt;hACKbUSTER&lt;/em&gt; and open-source animation organization &lt;em&gt;Animatious&lt;/em&gt;.">

    
    <meta name="author" content="Sergio Chan">
    
    <link rel="stylesheet" href="/css/vno.css" type="text/css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" type="text/css">

    
    <link rel="icon" href="/favicon.ico">
    

    <meta name="generator" content="hexo"/>
    

    <link rel="canonical" href="http://sergiochan.github.io/2016/08/18/ä½¿ç”¨-Photon-åœ¨-Unity-é‡Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå¤šäººè”æœºæ¸¸æˆ/"/>

    
</head>

<body class="home-template no-js">

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/image/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="å‰å¾€ Sergio Chan çš„ä¸»é¡µ"><img src="https://avatars2.githubusercontent.com/u/10103766?v=3&amp;s=460" width="80" alt="Sergio Chan logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Sergio Chan">Sergio Chan</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">Born hacker, Full-stack Developer</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">Crazy fan of Hackathons all around the world. <br/> Currently works at @RavenTech as the Leader of <em><strong>RavenLab Team</strong></em>.</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="" class="blog-button">Blog</a></li>
            
              <li class="navigation__item"><a href="/bio">Biography</a></li>
            
              <li class="navigation__item"><a href="/about">About</a></li>
            
              <li class="navigation__item"><a href="/portfolio">Portfolio</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  
  <li class="navigation__item">
    <a href="http://weibo.com/3089081773/profile?topnav=1&amp;wvr=6" title="My Weibo" target="_blank">
      <i class='social fa fa-weibo'></i>
      <span class="label">Weibo</span>
    </a>
  </li> 


  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/SergioChan" title="My Github" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  <li class="navigation__item">
    <a href="https://twitter.com/Sergio2Chan" title="Twitter" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>

  
<!-- Linkedin -->

  <li class="navigation__item">
    <a href="https://cn.linkedin.com/pub/sergio-chan/42/14b/a6" title="Linkedin" target="_blank">
      <i class='social fa fa-linkedin'></i>
      <span class="label">Linkedin</span>
    </a>
  </li>




  <li class="navigation__item">
    <a href="mailto:cyh9211@icloud.com" title="Email" target="_blank">
      <i class='social fa fa-envelope'></i>
      <span class="label">Email</span>
    </a>
  </li>


  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-slate"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2016-08-18T08:17:02.000Z" class="post-list__meta--date date">2016-08-18</time> &#8226; <span class="post-meta__tags tags">äº&nbsp;
  <a class="tag-link" href="/tags/Photon/">Photon</a>, <a class="tag-link" href="/tags/Unity/">Unity</a>
</span>
    </div>
    <h1 class="post-title">ä½¿ç”¨ Photon åœ¨ Unity é‡Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå¤šäººè”æœºæ¸¸æˆ</h1>
  </header>

  <section class="post article-entry">
    <script src="/assets/js/APlayer.min.js"> </script><p>å¦‚ä½•æœ€å¿«çš„æ­å»ºä¸€ä¸ª Unity ä¸Šçš„å¤šäººæ¸¸æˆï¼Ÿç­”æ¡ˆä¹Ÿè®¸æ˜¯è‡ªå·±æ­å»ºä¸€ä¸ªæ¸¸æˆæœåŠ¡å™¨ï¼Œä¹Ÿè®¸æ˜¯ LAN è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯æœ€å¿«çš„è§£å†³æ–¹æ¡ˆè¿˜æ˜¯ä½¿ç”¨æˆç†Ÿçš„ç¬¬ä¸‰æ–¹åç«¯æœåŠ¡ï¼Œæˆ‘æ‰¾åˆ°äº† <a href="https://www.photonengine.com/en-US/Photon" target="_blank" rel="external">Photon</a>ï¼Œä¸€ä¸ªçœ‹èµ·æ¥ä¸é”™æœ€åè¯å®ä¹ŸæŒºé è°±çš„æ¸¸æˆåç«¯è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä¸€ä¸ªæ¸¸æˆæœåŠ¡å™¨ï¼Œæœ€ä¸»è¦çš„å°±æ˜¯å¯¹ä¸åŒå‚ä¸è€…çš„äº‹ä»¶åŒæ­¥å’Œä¸–ç•ŒçŠ¶æ€çš„åŒæ­¥ï¼Œæ‰€ä»¥æ ¹æœ¬è¿˜æ˜¯åœ¨äºå’ŒæœåŠ¡å™¨çš„é•¿è¿æ¥ä¸Šï¼Œè‡³äºæ¸¸æˆä¸­çš„ç”¨æˆ·ä½“ç³»ï¼Œç§¯åˆ†ä½“ç³»ï¼Œè´§å¸ä½“ç³»è¿™äº›ï¼Œå°±æ˜¯å±äºå¤§åç«¯çš„èŒƒç•´äº†ï¼Œä¹Ÿæ˜¯å¯ä»¥ç‹¬ç«‹äºæ¸¸æˆåŒæ­¥æœåŠ¡å™¨å­˜åœ¨çš„ç³»ç»Ÿã€‚</p>
<h3 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>é¦–å…ˆä½ éœ€è¦é›†æˆ <strong>Photon SDK For Unity</strong>ï¼Œä¸‹è½½åœ°å€åœ¨<a href="https://www.photonengine.com/en-US/Realtime/Download" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
<p><img src="/image/photon_1.png" alt="å›¾1"> </p>
<p>ä½ éœ€è¦å°†ä¸‹è½½ä¸‹æ¥çš„ <code>PhotoAssets</code> ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½æ‹–åˆ°ä½ çš„é¡¹ç›®çš„ <code>Assets</code> æ–‡ä»¶å¤¹é‡Œé¢ï¼Œæ³¨æ„åœ¨ <code>Plugins</code> é‡Œé¢æœ‰ä¸¤ä¸ª <code>Photon3Unity3D.dll</code>ï¼Œéœ€è¦å°† <code>Metro</code> æ–‡ä»¶å¤¹åˆ æ‰ï¼Œä¿ç•™ä¸€ä¸ªï¼Œå¦åˆ™åœ¨ Unity ç¼–è¯‘çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚</p>
<p>æ‹–è¿›å»ä¹‹ååªè¦ Unity ä¸­ Compile æ²¡æœ‰é—®é¢˜é‚£ç¬¬ä¸€æ­¥å°±å¤§åŠŸå‘Šæˆäº†ã€‚</p>
<h3 id="u811A_u672C_u521B_u5EFA"><a href="#u811A_u672C_u521B_u5EFA" class="headerlink" title="è„šæœ¬åˆ›å»º"></a>è„šæœ¬åˆ›å»º</h3><p>åˆ›å»ºä¸€ä¸ªä½ ç”¨æ¥ç»´æŠ¤æ¸¸æˆç½‘ç»œé€»è¾‘çš„è„šæœ¬ï¼Œä¾‹å¦‚å‘½åä¸º <code>GameNetworkClient.cs</code>ï¼Œç„¶åä½ éœ€è¦åœ¨å¤´éƒ¨åŠ ä¸Šè¿™å‡ ä¸ªå¼•ç”¨ï¼š</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span>Â <span class="keyword">System</span>.Collections;</span><br><span class="line"><span class="keyword">using</span>Â ExitGames.Client.Photon;</span><br><span class="line"><span class="keyword">using</span>Â ExitGames.Client.Photon.LoadBalancing;</span><br><span class="line"><span class="keyword">using</span>Â <span class="keyword">System</span>.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span>Â UnityEngine;</span><br><span class="line"><span class="keyword">using</span>Â HashtableÂ =Â ExitGames.Client.Photon.Hashtable;</span><br></pre></td></tr></table></figure>
<p>æ¥ç€å£°æ˜ä¸€ä¸ªç§æœ‰çš„ <code>LoadBalancingClient</code>å¯¹è±¡ï¼Œä½ çš„è„šæœ¬ä¸­çš„æ‰€æœ‰ç½‘ç»œé€»è¾‘éƒ½ä¼šé€šè¿‡è¿™ä¸ª <code>client</code> å¯¹è±¡æ¥å‘èµ·å’Œå›è°ƒã€‚æˆ‘ä»¬è¿™æ ·åœ¨ Start ä¸­åˆå§‹åŒ– <code>client</code> å¯¹è±¡ï¼š</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line"><span class="keyword">client</span> = <span class="keyword">new</span> LoadBalancingClient();</span><br><span class="line"><span class="keyword">client</span>.AppId = <span class="string">"&#123;ä½ çš„ App_id&#125;"</span>;  </span><br><span class="line"><span class="keyword">client</span>.OnStateChangeAction += <span class="keyword">this</span>.OnStateChanged;</span><br><span class="line"><span class="keyword">client</span>.OnOpResponseAction += <span class="keyword">this</span>.OnRespAction;</span><br><span class="line"><span class="keyword">client</span>.OnEventAction += <span class="keyword">this</span>.OnEvent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">client</span>.ConnectToRegionMaster(<span class="string">"asia"</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½ çš„ App_id å¯ä»¥åœ¨ Photon å®˜ç½‘æ³¨å†Œå®Œå…è´¹è´¦æˆ·ååœ¨è´¦æˆ·è¯¦æƒ…é¡µè·å–ï¼Œå…è´¹çš„è´¦æˆ·æ‹¥æœ‰ <strong>20</strong> ä¸ªåŒæ—¶åœ¨çº¿äººæ•°çš„é™é¢ï¼Œå¯¹äºå°èŒƒå›´å¥½å‹é—´çš„æ¸¸æˆå’Œæµ‹è¯•è¶³å¤Ÿäº†ã€‚</p>
</blockquote>
<p>å…¶ä¸­ï¼Œæœ€åä¸€è¡Œä»£ç å°±æ˜¯ <code>client</code> å»è¿æ¥ MasterServer çš„æ–¹æ³•ï¼Œè¿™é‡Œé¢ä¼ å…¥çš„å‚æ•°è¦æ ¹æ®ä½ çš„æ¸¸æˆæ‰€åœ¨åœ°åŒºæ¥ç¡®å®šï¼Œ Photon åœ¨å…¨çƒæœ‰å¾ˆå¤šåˆ†æ•£çš„æ•°æ®ä¸­å¿ƒï¼Œå› æ­¤æ”¯æŒå¾ˆå¤šåŒºåŸŸçš„è¿æ¥ï¼Œå…·ä½“æ”¯æŒçš„åœ°åŒºå’Œä»£ç å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>Region</th>
<th>Hosted in</th>
<th>Token</th>
</tr>
</thead>
<tbody>
<tr>
<td>Asia</td>
<td>Singapore</td>
<td>asia</td>
</tr>
<tr>
<td>Australia</td>
<td>Melbourne</td>
<td>au</td>
</tr>
<tr>
<td>Canada, East</td>
<td>Montreal</td>
<td>cae</td>
</tr>
<tr>
<td>Europe</td>
<td>Amsterdam</td>
<td>eu</td>
</tr>
<tr>
<td>Japan</td>
<td>Tokyo</td>
<td>jp</td>
</tr>
<tr>
<td>South America</td>
<td>Sao Paulo</td>
<td>sa</td>
</tr>
<tr>
<td>USA, East</td>
<td>Washington</td>
<td>us</td>
</tr>
<tr>
<td>USA, West</td>
<td>San JosÃ©</td>
<td>usw</td>
</tr>
</tbody>
</table>
<p>æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘æ”¹æˆäº† <code>asia</code>ï¼Œäº‹å®è¯æ˜æ–°åŠ å¡çš„æœåŠ¡å™¨æ˜¯æ¯”è¾ƒç¨³å®šçš„ã€‚</p>
<h3 id="u72B6_u6001_u7EF4_u62A4"><a href="#u72B6_u6001_u7EF4_u62A4" class="headerlink" title="çŠ¶æ€ç»´æŠ¤"></a>çŠ¶æ€ç»´æŠ¤</h3><p><code>client</code> çš„çŠ¶æ€ä¸»è¦å°±æ˜¯æ ¹æ®ä¸Šé¢åˆå§‹åŒ–çš„æ—¶å€™ç»™çš„ä¸‰ä¸ª Action æ¥ç»´æŠ¤çš„ï¼Œä½ éœ€è¦åœ¨ä½ çš„è„šæœ¬é‡Œä¸ºè¿™ä¸‰ä¸ª Action éƒ½åŠ ä¸Šä½ è‡ªå·±çš„ Handlerã€‚å½“ç„¶ï¼Œå¦‚æœä½ æƒ³æŒ‰ç…§ä»–çš„ demo é‡Œç¤ºèŒƒçš„é‚£æ ·å»ç»§æ‰¿ <code>client</code> å¹¶ä¸” override è¿™ä¸‰ä¸ª Action çš„å›è°ƒéƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
<h4 id="OnStateChanged"><a href="#OnStateChanged" class="headerlink" title="OnStateChanged"></a>OnStateChanged</h4><p>è¿”å›çš„æ˜¯ä¸€ä¸ª <code>ClientState</code> æšä¸¾å€¼ï¼Œä¸»è¦å°±æ˜¯ä¸€äº› client çŠ¶æ€çš„å€¼ï¼Œä¾‹å¦‚</p>
<p> <code>connecting</code>ï¼Œ<code>connected</code>ï¼Œ<code>joining</code>ä¹‹ç±»çš„ã€‚</p>
<h4 id="OnRespAction"><a href="#OnRespAction" class="headerlink" title="OnRespAction"></a>OnRespAction</h4><p>è¿”å›çš„æ˜¯ä¸€ä¸ª <code>OperationResponse</code> å¯¹è±¡ï¼Œå®ƒä¼šåœ¨æ¯æ¬¡ä½ ç”¨ <code>client</code> å¯¹è±¡è°ƒç”¨ä¸€äº›æ–¹æ³•å¹¶ä¸”è·å¾— response ä¹‹åè°ƒç”¨ï¼Œåˆ†åˆ«æœ‰ä¸‹é¢è¿™äº›ç±»å‹çš„ Operation:</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OperationCode</span> &#123;</span><br><span class="line">        [Obsolete(<span class="string">"Exchanging encrpytion keys is done internally in the lib now. Don't expect this operation-result."</span>)]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> ExchangeKeysForEncryption = <span class="number">250</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(255) Code for OpJoin, to get into a room.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> Join = <span class="number">255</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(230) Authenticates this peer and connects to a virtual application<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> Authenticate = <span class="number">230</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(229) Joins lobby (on master)<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> JoinLobby = <span class="number">229</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(228) Leaves lobby (on master)<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> LeaveLobby = <span class="number">228</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(227) Creates a game (or fails if name exists)<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> CreateGame = <span class="number">227</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(226) Join game (by name)<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> JoinGame = <span class="number">226</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(225) Joins random game (on master)<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> JoinRandomGame = <span class="number">225</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// public const byte CancelJoinRandom = 224; // obsolete, cause JoinRandom no longer is a "process". now provides result immediately</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(254) Code for OpLeave, to get out of a room.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> Leave = (<span class="keyword">byte</span>)<span class="number">254</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(253) Raise event (in a room, for other actors/players)<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> RaiseEvent = (<span class="keyword">byte</span>)<span class="number">253</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(252) Set Properties (of room or actor/player)<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> SetProperties = (<span class="keyword">byte</span>)<span class="number">252</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(251) Get Properties<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> GetProperties = (<span class="keyword">byte</span>)<span class="number">251</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(248) Operation code to change interest groups in Rooms (Lite application and extending ones).<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> ChangeGroups = (<span class="keyword">byte</span>)<span class="number">248</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(222) Request the rooms and online status for a list of friends (by name, which should be unique).<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> FindFriends = <span class="number">222</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(221) Request statistics about a specific list of lobbies (their user and game count).<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> GetLobbyStats = <span class="number">221</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(220) Get list of regional servers from a NameServer.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> GetRegions = <span class="number">220</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(219) WebRpc Operation.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> WebRpc = <span class="number">219</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¾‹å¦‚ <code>rasieEvent</code>ï¼Œ<code>setProperties</code> æˆ–è€…åŠ å…¥ç¦»å¼€æ¸¸æˆè¿™äº›è¯·æ±‚éƒ½æ˜¯ä¼šæœ‰æœåŠ¡å™¨çš„ response çš„ï¼Œä½ å¯ä»¥æ ¹æ®è¿”å›å¯¹è±¡çš„ <code>ReturnCode</code> æ¥åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸå¹¶ä¸”æ˜¯å¦æ‰§è¡Œä¸€äº›é”™è¯¯åçš„å¤„ç†ï¼Œ<code>ReturnCode</code> ä¸º 0 æˆåŠŸï¼Œä¸ä¸º 0 åˆ™å¤±è´¥ï¼Œå¦‚æœéœ€è¦ä¹Ÿå¯ä»¥ä» <code>DebugMessage</code> ä¸­è·å–é”™è¯¯æç¤ºä¿¡æ¯ã€‚</p>
<h4 id="OnEventAction"><a href="#OnEventAction" class="headerlink" title="OnEventAction"></a><strong>OnEventAction</strong></h4><p>è¿”å›çš„æ˜¯ä¸€ä¸ª <code>EventData</code> å¯¹è±¡ï¼Œå®ƒä¼šåœ¨æ¯æ¬¡ <code>client</code> æ¥æ”¶åˆ°æ–°çš„ Event çš„æ—¶å€™è°ƒç”¨ï¼Œå…·ä½“çš„ Event ç±»å‹æ ¹æ®<code>EventData</code> çš„ <code>EventCode</code> æ¥ç¡®å®šï¼Œåˆ†åˆ«æœ‰ä¸‹é¢è¿™äº›ç±»å‹çš„ <code>EventCode</code>:</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EventCode</span> &#123;</span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(230) Initial list of RoomInfos (in lobby on Master)<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> GameList = <span class="number">230</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(229) Update of RoomInfos to be merged into "initial" list (in lobby on Master)<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> GameListUpdate = <span class="number">229</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(228) Currently not used. State of queueing in case of server-full<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> QueueState = <span class="number">228</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(227) Currently not used. Event for matchmaking<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> Match = <span class="number">227</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(226) Event with stats about this application (players, rooms, etc)<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> AppStats = <span class="number">226</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(224) This event provides a list of lobbies with their player and game counts.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> LobbyStats = <span class="number">224</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(210) Internally used in case of hosting by Azure<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        [Obsolete(<span class="string">"TCP routing was removed after becoming obsolete."</span>)]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> AzureNodeInfo = <span class="number">210</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(255) Event Join: someone joined the game. The new actorNumber is provided as well as the properties of that actor (if set in OpJoin).<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> Join = (<span class="keyword">byte</span>)<span class="number">255</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(254) Event Leave: The player who left the game can be identified by the actorNumber.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> Leave = (<span class="keyword">byte</span>)<span class="number">254</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(253) When you call OpSetProperties with the broadcast option "on", this event is fired. It contains the properties being set.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> PropertiesChanged = (<span class="keyword">byte</span>)<span class="number">253</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(253) When you call OpSetProperties with the broadcast option "on", this event is fired. It contains the properties being set.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        [Obsolete(<span class="string">"Use PropertiesChanged now."</span>)]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> SetProperties = (<span class="keyword">byte</span>)<span class="number">253</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(252) When player left game unexpected and the room has a playerTtl &gt; 0, this event is fired to let everyone know about the timeout.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> Obsolete. Replaced by Leave. public const byte Disconnect = LiteEventCode.Disconnect;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(251) Sent by Photon Cloud when a plugin-call or webhook-call failed. Usually, the execution on the server continues, despite the issue. Contains: ParameterCode.Info.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;seealso cref="https://doc.photonengine.com/en/realtime/current/reference/webhooks"/&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> ErrorInfo = <span class="number">251</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>(250) Sent by Photon whent he event cache slice was changed. Done by OpRaiseEvent.<span class="xmlDocTag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">byte</span> CacheSliceChanged = <span class="number">250</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„ <code>EventCode</code> ä½ æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰çš„ï¼Œè¿™ä¸ª code æ˜¯ä¸ª <strong>byte ç±»å‹çš„æ•´æ•°</strong>ï¼Œå› æ­¤ä¸èƒ½å¤§äº255ï¼ŒPhoton å°†ä» 0 å¼€å§‹çš„ä¸€å¤§æ®µå€¼åŸŸéƒ½ç•™ç»™å¼€å‘è€…ç”¨æ¥è‡ªå®šä¹‰äº‹ä»¶äº†ã€‚Photon é»˜è®¤æä¾›äº† <code>GameList</code>ï¼Œæˆ–è€…è¯´ RoomList çš„åŠŸèƒ½ï¼Œä½ å¯ä»¥åˆ›å»º <code>Room</code> å¹¶ä¸”åŠ å…¥ï¼Œ<code>Room</code> ä¹Ÿæœ‰ä»–è‡ªå·±çš„ Optionï¼Œå¯ä»¥ä½œä¸º Lobbyï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰äººé»˜è®¤è¿›å…¥çš„ <code>Room</code>ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®å„ç§æ¡ä»¶æ¥æŸ¥æ‰¾ <code>Room</code>ã€‚</p>
<p>è¿™é‡Œçš„ <strong>253 PropertiesChanged</strong> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ Eventï¼Œåœ¨ä¸Šé¢æˆ‘æåˆ°è¿‡ï¼Œè”æœºæ¸¸æˆçš„åç«¯æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€å°±æ˜¯ä¸–ç•ŒçŠ¶æ€çš„åŒæ­¥ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯<strong>æˆ¿é—´çš„çŠ¶æ€ Room Properties</strong>ï¼Œå› æ­¤åœ¨ Photon SDK ä¸­ï¼Œå½“ä½ è°ƒç”¨ <code>client</code> å¯¹å½“å‰åŠ å…¥çš„ <code>Room</code> çš„æŸä¸ªå±æ€§åšå‡ºäº†æ”¹å˜ï¼Œè¿™å°±ä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶é€šçŸ¥åˆ°æ•´ä¸ª <code>Room</code> é‡Œçš„æ‰€æœ‰ç©å®¶ï¼Œè¿™é€šå¸¸ç”¨æ¥åŒæ­¥ä¸€äº›å…¨å±€çš„å±æ€§ï¼Œä¾‹å¦‚å…‰çº¿ï¼Œåœ°å½¢ï¼Œæ€ªç‰©çš„è¡€é‡ä¹‹ç±»çš„ã€‚</p>
<p>å½“ç„¶ï¼Œä½ è¿˜å¯ä»¥è‡ªå®šä¹‰ Eventï¼Œåœ¨æˆ‘å®ç°çš„ demo ä¸­æˆ‘å°±æ˜¯ç”¨åˆ°äº†è‡ªå®šä¹‰ Event æ¥å‘ŠçŸ¥å…¶ä»–ç©å®¶æˆ‘çš„çŠ¶æ€ã€‚æ¯”å¦‚ï¼Œæ•´ä¸ªåœ°å›¾ ï¼ˆå¯ä»¥çœ‹åšå°±æ˜¯ä¸€ä¸ª <code>Room</code>ï¼‰ä¸­çš„ç©å®¶åˆ—è¡¨å’Œä½ç½®æ˜¯å¯ä»¥ç”¨å…¨å±€çŠ¶æ€æ¥åŒæ­¥çš„ï¼Œä½†æ˜¯ä¾‹å¦‚å•ä¸ªç©å®¶çš„ä¸€äº›äº‹ä»¶ï¼ˆä½¿ç”¨ç‰©å“ï¼Œä½¿ç”¨æŠ€èƒ½ä¹‹ç±»çš„ï¼‰å¯èƒ½å°±éœ€è¦ç”±å‘èµ·çš„ç”¨æˆ·å‘å…¨ <code>Room</code> çš„å…¶ä»–ç©å®¶å‘é€ä¸€ä¸ªåŒæ­¥äº‹ä»¶ã€‚</p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span> eventCode = <span class="number">1</span>; </span><br><span class="line">Hashtable evData = <span class="keyword">new</span> Hashtable (); </span><br><span class="line">evData.Add (<span class="string">"player_id"</span>, random_playerid);</span><br><span class="line">evData.Add (<span class="string">"pos_x"</span>, position.x);</span><br><span class="line">evData.Add (<span class="string">"pos_y"</span>, position.y);</span><br><span class="line"></span><br><span class="line">bool sendReliable = <span class="keyword">true</span>; </span><br><span class="line"><span class="keyword">if</span> (isConnected) &#123;</span><br><span class="line">	<span class="keyword">client</span>.OpRaiseEvent (eventCode, evData, sendReliable, RaiseEventOptions.Default);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç„¶åè¿™ä¸ªäº‹ä»¶å°±ä¼šåœ¨é™¤äº†å‘é€è€…è‡ªå·±çš„å…¶ä»–ç©å®¶çš„å®¢æˆ·ç«¯è¢«å›è°ƒã€‚</p>
</blockquote>
<p><strong>è¿™ä¸ªæ—¶å€™æ”¶åˆ°çš„æ•°æ®åŒ…æ€ä¹ˆè§£å‡ºæ¥å‘¢ï¼Ÿ</strong></p>
<p>æœ€åå†è¯´è¯´å‘äº†æˆ‘åŠå¤©çš„ <code>EventData</code> ä¸­çš„æ•°æ®æŠ½å–ï¼Œåœ¨ <code>EventData</code> ä¸­çš„æ•°æ®æ ¼å¼ååˆ†è›‹ç–¼ï¼Œä¾‹å¦‚ä¸Šé¢è¿™æ®µä»£ç é‡Œå‘é€çš„æ•°æ®ï¼Œå½“ä½ åœ¨å…¶ä»–å®¢æˆ·ç«¯æ”¶åˆ°çš„æ—¶å€™ï¼Œå®ƒçš„æ•°æ®å…¶å®æ˜¯å­˜åœ¨ <code>EventData</code> çš„ <code>Parameters</code> è¿™ä¸ªå±æ€§å˜é‡é‡Œé¢ï¼Œè¿™æ˜¯ä¸€ä¸ª <code>Dictionary&lt;byte,object&gt;</code> ç±»å‹çš„å¯¹è±¡ï¼Œé€šè¿‡ <code>ParameterCode.Data</code> è¿™ä¸ª key å°† data å–å‡ºæ¥ä¹‹åï¼Œé‡Œé¢æ‰æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ Hashtable ï¼Œç„¶è€Œç°åœ¨å·²ç»å˜æˆäº†ä¸€ä¸ª <code>Dictionary&lt;object,object&gt;</code> å¯¹è±¡äº†ã€‚åœ¨æ²¡æœ‰ä»”ç»†æŸ¥çœ‹æºç çš„æƒ…å†µä¸‹ï¼Œå®ƒçš„å®˜æ–¹ demo å’Œæ–‡æ¡£å¹¶æ²¡æœ‰æåŠå¦‚ä½•è§£åŒ… <code>EventData</code> ,å› æ­¤æˆ‘æ˜¯é€šè¿‡ Debug çš„æ–¹å¼æ‰æœ€ç»ˆæ‘¸æ¸…äº†é‡Œé¢çš„æ•°æ®æ ¼å¼ã€‚å½“ç„¶åæ¥åˆçœ‹äº†ä¸‹å®ƒçš„å¤´æ–‡ä»¶ï¼Œæ‰çœ‹åˆ° <code>ParameterCode.Data</code> ğŸ˜‚ã€‚</p>

  </section>

</article>


<section class="post-comments">
  <!-- å¤šè¯´è¯„è®ºæ¡† start -->
  <div class="ds-thread" data-thread-key="http://sergiochan.github.io/2016/08/18/ä½¿ç”¨-Photon-åœ¨-Unity-é‡Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå¤šäººè”æœºæ¸¸æˆ/" data-title="ä½¿ç”¨ Photon åœ¨ Unity é‡Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå¤šäººè”æœºæ¸¸æˆ" data-url="http://sergiochan.github.io/2016/08/18/ä½¿ç”¨-Photon-åœ¨-Unity-é‡Œå¿«é€Ÿæ­å»ºä¸€ä¸ªå¤šäººè”æœºæ¸¸æˆ/"></div>
  <!-- å¤šè¯´è¯„è®ºæ¡† end -->
  <!-- å¤šè¯´å…¬å…±JSä»£ç  start (ä¸€ä¸ªç½‘é¡µåªéœ€æ’å…¥ä¸€æ¬¡) -->
  <script type="text/javascript">
  var duoshuoQuery = {short_name:"sergiochan"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- å¤šè¯´å…¬å…±JSä»£ç  end -->
</section>



            <footer class="footer">
    <span class="footer__copyright">
        æœ¬ç«™ç‚¹é‡‡ç”¨<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>
    </span>
    <span class="footer__copyright">
        &copy; 2014 - 2016 æœ¬ç«™ç”± <a href="/">@Sergio Chan</a> åˆ›å»º,
    </span>
</footer>

        </div>
    </div>

    <script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js" type="text/javascript"></script>
    <script src="/js/main.js" type="text/javascript"></script>

     
</body>
</html>
